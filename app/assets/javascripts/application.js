// Generated by CoffeeScript 1.9.3
(function() {
  var $, _, env, fullcalendar, h, ical,
    slice = [].slice;

  _ = require('underscore');

  $ = require('jquery');

  fullcalendar = require('fullcalendar');

  h = require('helpers');

  ical = require('ical');

  console.log("HI THERE");

  env = window.env = {};

  $(document).ready(function() {
    var _colors, calendar, color;
    console.log("READY!");
    calendar = env.calendar = function() {
      var args, el;
      args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
      el = $('#calendar');
      return el.fullCalendar.apply(el, args);
    };
    calendar({});
    _colors = ["#B35982", "#9BC362", "#4F9D66", "#D4796A"];
    color = window.color = function() {
      var ret;
      ret = _colors.shift();
      _colors.push(ret);
      return ret;
    };
    return $('#files').change(function(evt) {
      var files;
      files = evt.target.files;
      return _.each(files, function(file) {
        var reader;
        if (file.type !== "text/calendar") {
          return console.error("wrong file type: " + file.type);
        }
        reader = new FileReader;
        reader.onload = function(e) {
          var events, ics;
          ics = ical.parseICS(e.target.result);
          events = _.map(_.values(_.omit(ics, 'prodid')), function(data) {
            return {
              title: data.summary,
              allDay: true,
              start: data.start,
              end: data.end
            };
          });
          return calendar('addEventSource', {
            events: events,
            color: color()
          });
        };
        return reader.readAsText(file);
      });
    });
  });

}).call(this);
